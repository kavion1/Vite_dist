import{d as x,r as f,a as E,o as y,c as k,b as o,w as a,u as c,e as b,f as w,t as q,M as R,E as V,g as $,h as T,i as F,j as N,k as U,_ as C,l as A,m as P,n as B,p as D,q as M,s as S,v as L,x as j}from"./index-53c648b4.js";/* empty css                */const z={class:"CodePass"},G=x({__name:"signIn",emits:["getActiveName"],setup(I,{emit:_}){const{proxy:r}=U();let t=f({phone_num:"",phone_code:"",password:"",confirm:""});const u=f(),m=E({phone_num:[{required:!0,message:"请输入手机号",trigger:"blur"}],phone_code:[{required:!0,message:"请输入验证码",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{validator(d,e,n){e&&/^(?=.*[a-zA-Z])(?=.*\d).{6,}$/.test(e)?n():n("请输入长度至少为六位且需包含至少一个字母和一个数字！")},trigger:"blur"}],confirm:[{required:!0,message:"请确认密码",trigger:"blur"}]}),p=f(0),v=d=>{d.validateField("phone_num",(e,n)=>{var s;e&&((s=r.$axios)==null||s.get("/apis/api/1.0/user/smsCode",{phone_num:t.value.phone_num}).then(i=>{if(i.re_code==0){p.value=60;const g=setInterval(()=>{p.value=p.value-1,p.value==0&&clearTimeout(g)},1e3)}}).catch(i=>{console.log("验证码错误",i)}))})},h=async d=>{d&&await d.validate((e,n)=>{if(e){const s={phone_num:t.value.phone_num,phone_code:t.value.password,password:t.value.password};r==null||r.$axios.post("/apis/api/1.0/user/register",{...s,password:R.hashStr(t.value.password)}).then(i=>{i.re_code==="0"?(t.value={phone_num:"",phone_code:"",password:"",confirm:""},V({message:"注册成功",type:"success"}),setTimeout(()=>{_("getActiveName","login")},500)):V({message:i.msg||"注册失败",type:"error"})})}else console.log("error handleRegister!",n)})};return(d,e)=>{const n=$,s=T,i=F,g=N;return y(),k("div",null,[o(g,{ref_key:"ruleFormRef",ref:u,model:c(t),rules:m,"status-icon":""},{default:a(()=>[o(s,{prop:"phone_num"},{default:a(()=>[o(n,{modelValue:c(t).phone_num,"onUpdate:modelValue":e[0]||(e[0]=l=>c(t).phone_num=l),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),o(s,{prop:"phone_code"},{default:a(()=>[b("div",z,[o(n,{modelValue:c(t).phone_code,"onUpdate:modelValue":e[1]||(e[1]=l=>c(t).phone_code=l),clearable:"",placeholder:"请输入验证码"},null,8,["modelValue"]),o(i,{onClick:e[2]||(e[2]=l=>v(u.value)),disabled:p.value!=0},{default:a(()=>[w(q(p.value==0?"获取验证码":p.value+"后重新获取"),1)]),_:1},8,["disabled"])])]),_:1}),o(s,{prop:"password"},{default:a(()=>[o(n,{modelValue:c(t).password,"onUpdate:modelValue":e[3]||(e[3]=l=>c(t).password=l),placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),o(s,{prop:"confirm"},{default:a(()=>[o(n,{modelValue:c(t).confirm,"onUpdate:modelValue":e[4]||(e[4]=l=>c(t).confirm=l),placeholder:"请确认密码"},null,8,["modelValue"])]),_:1}),o(s,{class:"login-form-item"},{default:a(()=>[o(i,{class:"login-button",type:"primary",onClick:e[5]||(e[5]=l=>h(u.value))},{default:a(()=>[w("注册")]),_:1})]),_:1})]),_:1},8,["model","rules"])])}}});const K=C(G,[["__scopeId","data-v-d65f6c5b"]]),Z=x({__name:"login",setup(I){const{proxy:_}=U(),r=f({phone_num:"",password:""}),t=A(),{cookies:u}=P(),m=f(),v=E({phone_num:[{required:!0,message:"请输入手机号",trigger:"blur"},{validator:(d,e,n)=>{console.log("shuang value",e),e?/^1[0-9]{10}$/.test(e)?n():n(new Error("请输入正确的电话号码")):n(new Error("电话号码不能为空"))},trigger:"change"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]}),h=async d=>{d&&await d.validate((e,n)=>{e?_==null||_.$axios.post("/apis/api/1.0/user/login",{account:+r.value.phone_num,password:R.hashStr(r.value.password)}).then(s=>{if(s&&s.re_code==="0"){const{access_token:i="",access_token_exp:g="",refresh_token:l=""}=s.data;console.log("login success"),u.set("access_token",i),u.set("access_token_exp",g),u.set("refresh_token",l),u.set("account",r.value.phone_num||"润润"),t.push("/transaction_record")}else V({message:s.msg||"登录失败",type:"error"})}):console.log("error submit!",n)})};return(d,e)=>{const n=$,s=T,i=F,g=N;return y(),k("div",null,[o(g,{ref_key:"ruleFormRef",ref:m,model:r.value,rules:v,"status-icon":""},{default:a(()=>[o(s,{class:"login-form-item",prop:"phone_num"},{default:a(()=>[o(n,{modelValue:r.value.phone_num,"onUpdate:modelValue":e[0]||(e[0]=l=>r.value.phone_num=l),"prefix-icon":"UserFilled",placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),o(s,{class:"login-form-item",prop:"password"},{default:a(()=>[o(n,{type:"password",modelValue:r.value.password,"onUpdate:modelValue":e[1]||(e[1]=l=>r.value.password=l),"prefix-icon":"Key",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),o(s,{class:"login-form-item"},{default:a(()=>[o(i,{class:"login-button",type:"primary",onClick:e[2]||(e[2]=l=>h(m.value))},{default:a(()=>[w("登录")]),_:1})]),_:1})]),_:1},8,["model","rules"])])}}});const H=C(Z,[["__scopeId","data-v-9196b713"]]),J={class:"common-layout"},O={class:"login-container"},Q={style:{"margin-top":"20px"}},W={style:{"margin-top":"20px"}},X=x({__name:"index",setup(I){let _=f("login");const r=u=>{_.value=u},t=(u,m)=>{console.log("tab.props.name",u.props.name)};return(u,m)=>{const p=M,v=S,h=L,d=j,e=B;return y(),k("div",J,[o(e,null,{default:a(()=>[o(d,null,{default:a(()=>[b("div",O,[o(h,{class:"login-card",shadow:"hover"},{default:a(()=>[o(v,{modelValue:c(_),"onUpdate:modelValue":m[0]||(m[0]=n=>D(_)?_.value=n:_=n),type:"card",onTabClick:t,stretch:!0},{default:a(()=>[o(p,{label:"登录",name:"login"},{default:a(()=>[b("div",Q,[o(H)])]),_:1}),o(p,{label:"注册",name:"signIn"},{default:a(()=>[b("div",W,[o(K,{onGetActiveName:r})])]),_:1})]),_:1},8,["modelValue"])]),_:1})])]),_:1})]),_:1})])}}});const oe=C(X,[["__scopeId","data-v-86bb1778"]]);export{oe as default};
