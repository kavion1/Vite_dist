import{d as y,r as f,a as E,o as x,c as k,b as o,w as a,u as c,e as w,f as b,t as q,M as R,E as V,g as T,h as $,i as F,j as N,k as U,_ as C,l as P,m as A,n as B,p as D,q as M,s as S,v as L,x as j}from"./index-1be18368.js";/* empty css                */const G={class:"CodePass"},K=y({__name:"signIn",emits:["getActiveName"],setup(I,{emit:i}){const{proxy:r}=U();let s=f({phone_num:"",phone_code:"",password:"",confirm:""});const d=f(),m=E({phone_num:[{required:!0,message:"请输入手机号",trigger:"blur"}],phone_code:[{required:!0,message:"请输入验证码",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],confirm:[{required:!0,message:"请确认密码",trigger:"blur"}]}),p=f(0),v=_=>{_.validateField("phone_num",(e,t)=>{var n;e&&((n=r.$axios)==null||n.get("/apis/api/1.0/user/smsCode",{phone_num:s.value.phone_num}).then(u=>{if(u.re_code==0){p.value=60;const g=setInterval(()=>{p.value=p.value-1,p.value==0&&clearTimeout(g)},1e3)}}).catch(u=>{console.log("验证码错误",u)}))})},h=async _=>{_&&await _.validate((e,t)=>{if(e){const n={phone_num:s.value.phone_num,phone_code:s.value.password,password:s.value.password};r==null||r.$axios.post("/apis/api/1.0/user/register",{...n,password:R.hashStr(s.value.password)}).then(u=>{u.re_code==="0"?(s.value={phone_num:"",phone_code:"",password:"",confirm:""},V({message:"注册成功",type:"success"}),setTimeout(()=>{i("getActiveName","login")},500)):V({message:u.msg||"注册失败",type:"error"})})}else console.log("error handleRegister!",t)})};return(_,e)=>{const t=T,n=$,u=F,g=N;return x(),k("div",null,[o(g,{ref_key:"ruleFormRef",ref:d,model:c(s),rules:m,"status-icon":""},{default:a(()=>[o(n,{prop:"phone_num"},{default:a(()=>[o(t,{modelValue:c(s).phone_num,"onUpdate:modelValue":e[0]||(e[0]=l=>c(s).phone_num=l),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),o(n,{prop:"phone_code"},{default:a(()=>[w("div",G,[o(t,{modelValue:c(s).phone_code,"onUpdate:modelValue":e[1]||(e[1]=l=>c(s).phone_code=l),clearable:"",placeholder:"请输入验证码"},null,8,["modelValue"]),o(u,{onClick:e[2]||(e[2]=l=>v(d.value)),disabled:p.value!=0},{default:a(()=>[b(q(p.value==0?"获取验证码":p.value+"后重新获取"),1)]),_:1},8,["disabled"])])]),_:1}),o(n,{prop:"password"},{default:a(()=>[o(t,{modelValue:c(s).password,"onUpdate:modelValue":e[3]||(e[3]=l=>c(s).password=l),placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),o(n,{prop:"confirm"},{default:a(()=>[o(t,{modelValue:c(s).confirm,"onUpdate:modelValue":e[4]||(e[4]=l=>c(s).confirm=l),placeholder:"请确认密码"},null,8,["modelValue"])]),_:1}),o(n,{class:"login-form-item"},{default:a(()=>[o(u,{class:"login-button",type:"primary",onClick:e[5]||(e[5]=l=>h(d.value))},{default:a(()=>[b("注册")]),_:1})]),_:1})]),_:1},8,["model","rules"])])}}});const z=C(K,[["__scopeId","data-v-a8940662"]]),H=y({__name:"login",setup(I){const{proxy:i}=U(),r=f({phone_num:"",password:""}),s=P(),{cookies:d}=A(),m=f(),v=E({phone_num:[{required:!0,message:"请输入手机号",trigger:"blur"},{validator:(_,e,t)=>{console.log("shuang value",e),e?/^1[0-9]{10}$/.test(e)?t():t(new Error("请输入正确的电话号码")):t(new Error("电话号码不能为空"))},trigger:"change"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]}),h=async _=>{_&&await _.validate((e,t)=>{e?i==null||i.$axios.post("/apis/api/1.0/user/login",{account:+r.value.phone_num,password:R.hashStr(r.value.password)}).then(n=>{if(n&&n.re_code==="0"){const{access_token:u="",access_token_exp:g="",refresh_token:l=""}=n.data;console.log("login success"),d.set("access_token",u),d.set("access_token_exp",g),d.set("refresh_token",l),s.push("/transaction_record")}else V({message:n.msg||"登录失败",type:"error"})}):console.log("error submit!",t)})};return(_,e)=>{const t=T,n=$,u=F,g=N;return x(),k("div",null,[o(g,{ref_key:"ruleFormRef",ref:m,model:r.value,rules:v,"status-icon":""},{default:a(()=>[o(n,{class:"login-form-item",prop:"phone_num"},{default:a(()=>[o(t,{modelValue:r.value.phone_num,"onUpdate:modelValue":e[0]||(e[0]=l=>r.value.phone_num=l),"prefix-icon":"UserFilled",placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),o(n,{class:"login-form-item",prop:"password"},{default:a(()=>[o(t,{type:"password",modelValue:r.value.password,"onUpdate:modelValue":e[1]||(e[1]=l=>r.value.password=l),"prefix-icon":"Key",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),o(n,{class:"login-form-item"},{default:a(()=>[o(u,{class:"login-button",type:"primary",onClick:e[2]||(e[2]=l=>h(m.value))},{default:a(()=>[b("登录")]),_:1})]),_:1})]),_:1},8,["model","rules"])])}}});const J=C(H,[["__scopeId","data-v-70f08565"]]),O={class:"common-layout"},Q={class:"login-container"},W={style:{"margin-top":"20px"}},X={style:{"margin-top":"20px"}},Y=y({__name:"index",setup(I){let i=f("login");const r=d=>{i.value=d},s=(d,m)=>{console.log("tab.props.name",d.props.name)};return(d,m)=>{const p=M,v=S,h=L,_=j,e=B;return x(),k("div",O,[o(e,null,{default:a(()=>[o(_,null,{default:a(()=>[w("div",Q,[o(h,{class:"login-card",shadow:"hover"},{default:a(()=>[o(v,{modelValue:c(i),"onUpdate:modelValue":m[0]||(m[0]=t=>D(i)?i.value=t:i=t),type:"card",onTabClick:s,stretch:!0},{default:a(()=>[o(p,{label:"登录",name:"login"},{default:a(()=>[w("div",W,[o(J)])]),_:1}),o(p,{label:"注册",name:"signIn"},{default:a(()=>[w("div",X,[o(z,{onGetActiveName:r})])]),_:1})]),_:1},8,["modelValue"])]),_:1})])]),_:1})]),_:1})])}}});const oe=C(Y,[["__scopeId","data-v-607398a0"]]);export{oe as default};
